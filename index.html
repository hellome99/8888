<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>大垣ケーブルテレビ Webmail (Safe Stub)</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self'; form-action 'self'; base-uri 'self'; frame-ancestors 'none'">
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', sans-serif; margin: 0; padding: 2rem; background: #f8f9fa; color: #212529; }
      .container { max-width: 560px; margin: 0 auto; background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
      h1 { font-size: 1.25rem; margin: 0 0 1rem; }
      .notice { background: #fff3cd; border: 1px solid #ffe69c; color: #664d03; padding: .75rem; border-radius: 6px; margin-bottom: 1rem; }
      .field { margin-bottom: .75rem; }
      label { display: block; font-weight: 600; margin-bottom: .25rem; }
      input { width: 100%; padding: .5rem .625rem; border: 1px solid #ced4da; border-radius: 6px; font-size: 1rem; }
      button { padding: .5rem .875rem; border-radius: 6px; border: 1px solid #ced4da; background: #e9ecef; color: #495057; cursor: not-allowed; }
      .muted { color: #6c757d; font-size: .875rem; }
      .row { display: flex; gap: .5rem; align-items: center; }
      .btn { cursor: pointer; background: #0d6efd; color: #fff; border: 1px solid #0b5ed7; }
      .btn[disabled] { cursor: not-allowed; background: #6c757d; border-color: #6c757d; }
      .status { margin-top: .5rem; font-size: .9rem; }
      .status.ok { color: #0a7d28; }
      .status.err { color: #b02a37; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1><a>大垣ケーブルテレビ Webmail</a></h1>
      <div class="notice">This is a safe stub. Form submission is disabled and no data is sent anywhere.</div>

      <form class="propform" id="login-form" name="login-form" onsubmit="return false;" autocomplete="off" novalidate>
        <div class="field">
          <label for="username">ユーザー名</label>
          <input id="username" name="username" type="text" inputmode="email" autocomplete="off" placeholder="example@domain.jp">
        </div>
        <div class="field">
          <label for="password">パスワード</label>
          <input id="password" name="password" type="password" autocomplete="new-password" placeholder="••••••••">
        </div>
        <button type="submit" disabled>送信は無効化されています</button>
        <div class="muted" style="margin-top:.5rem;">Submission is intentionally disabled for safety.</div>
      </form>

      <hr style="margin:1.25rem 0; border:none; border-top:1px solid #e9ecef;">
      <div class="row">
        <button id="telegram-test" class="btn" type="button" style="cursor:pointer">Telegram 接続テスト</button>
        <span id="telegram-status" class="status muted">No test sent yet.</span>
      </div>
    </div>

    <script>
      (function preventSubmission() {
        const form = document.getElementById('login-form');
        if (!form) return;
        form.addEventListener('submit', function (event) {
          event.preventDefault();
          return false;
        });
        document.querySelectorAll('#login-form [formaction]').forEach(function(button) {
          button.removeAttribute('formaction');
        });
      })();

      (function telegramHealthCheck(){
        const btn = document.getElementById('telegram-test');
        const status = document.getElementById('telegram-status');
        if (!btn || !status) return;
        btn.addEventListener('click', async function(){
          btn.setAttribute('disabled', 'true');
          status.className = 'status';
          status.textContent = 'Sending health check...';
          try {
            const res = await fetch('telegram_test.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ ping: true }) // does not include user inputs
            });
            const data = await res.json().catch(() => ({}));
            if (res.ok) {
              status.className = 'status ok';
              status.textContent = data && data.message ? data.message : 'Telegram health check sent.';
            } else {
              status.className = 'status err';
              status.textContent = data && data.error ? data.error : 'Failed to send Telegram health check.';
            }
          } catch (err) {
            status.className = 'status err';
            status.textContent = 'Network error while sending health check.';
          } finally {
            btn.removeAttribute('disabled');
          }
        });
      })();
    </script>
  </body>
</html>